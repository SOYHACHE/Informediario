<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Generador Informe Seguridad</title>

  <!-- PWA -->
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#4CAF50">

  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 15px;
      background-color: #f0f0f0;
    }
    .campo {
      margin-bottom: 15px;
    }
    label {
      display: block;
      font-weight: bold;
      margin-bottom: 5px;
      color: #333;
    }
    input, textarea, select {
      width: 100%;
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 5px;
      box-sizing: border-box;
      font-size: 16px;
    }
    textarea {
      height: 80px;
      resize: vertical;
    }
    button {
      width: 100%;
      padding: 12px;
      border: none;
      border-radius: 5px;
      font-size: 16px;
      cursor: pointer;
      margin-top: 10px;
    }
    #generar { background-color: #2c3e50; color: white; }
    #copiar { background-color: #27ae60; color: white; }
    #vaciar { background-color: #e74c3c; color: white; margin-top: 20px; }

    #informe-generado {
      margin-top: 20px;
      padding: 15px;
      background-color: white;
      border-radius: 5px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      display: none;
    }
    #cuadro-informe {
      width: 100%;
      height: 220px;
      resize: vertical;
      white-space: pre-line;
    }
    .mensaje {
      margin-top: 10px;
      padding: 10px;
      border-radius: 5px;
      display: none;
    }
    #mensaje-copiado {
      background-color: #d4edda;
      color: #155724;
    }
    #mensaje-vaciado {
      background-color: #f8d7da;
      color: #721c24;
    }
  </style>
</head>

<body>

<h2>Generador de Informe Seguridad</h2>

<div class="campo">
  <label>FECHA:</label>
  <input type="date" id="fecha">
</div>

<div class="campo">
  <label>SECTOR:</label>
  <input type="text" id="sector" placeholder="Ej: Suc.209">
</div>

<div class="campo">
  <label>AUSENTISMO:</label>
  <textarea id="ausentismo"></textarea>
</div>

<div class="campo">
  <label>CANTIDAD DE MÓVILES DEL CD A RECEPCIONAR:</label>
  <input type="number" id="moviles-cd" min="0">
</div>

<div class="campo">
  <label>PULMÓN Y PASILLOS TÉCNICOS:</label>
  <textarea id="pulmon-pasillos"></textarea>
</div>

<div class="campo">
  <label>VTS FRÍO:</label>
  <select id="novedades-frio">
    <option value="sin">Sin novedades</option>
    <option value="con">Con novedades</option>
  </select>
  <textarea id="detalle-frio" style="display:none;margin-top:5px;"></textarea>
</div>

<div class="campo">
  <label>VTS PRECINTOS:</label>
  <select id="novedades-precintos">
    <option value="sin">Sin novedades</option>
    <option value="con">Con novedades</option>
  </select>
  <textarea id="detalle-precintos" style="display:none;margin-top:5px;"></textarea>
</div>

<div class="campo">
  <label>CCTV:</label>
  <textarea id="cctv"></textarea>
</div>

<button id="generar">GENERAR INFORME</button>

<div id="informe-generado">
  <h3>Informe Generado</h3>
  <textarea id="cuadro-informe" readonly></textarea>
  <button id="copiar">COPIAR</button>
  <p class="mensaje" id="mensaje-copiado">Informe copiado</p>
</div>

<button id="vaciar">VACIAR TODO</button>
<p class="mensaje" id="mensaje-vaciado">Datos eliminados</p>

<script>
/* =======================
   REGISTRO SERVICE WORKER
======================= */
if ("serviceWorker" in navigator) {
  window.addEventListener("load", () => {
    navigator.serviceWorker.register("./service-worker.js");
  });
}

/* =======================
   LOCAL STORAGE
======================= */
const campos = [
  "fecha","sector","ausentismo","moviles-cd",
  "pulmon-pasillos","novedades-frio","detalle-frio",
  "novedades-precintos","detalle-precintos","cctv"
];

function guardar() {
  const data = {};
  campos.forEach(id => data[id] = document.getElementById(id).value);
  localStorage.setItem("informeSeguridad", JSON.stringify(data));
}

function cargar() {
  const data = JSON.parse(localStorage.getItem("informeSeguridad") || "{}");
  campos.forEach(id => {
    if (data[id]) document.getElementById(id).value = data[id];
  });
  toggleDetalles();
}

function toggleDetalles() {
  detalle-frio.style.display =
    novedades-frio.value === "con" ? "block" : "none";
  detalle-precintos.style.display =
    novedades-precintos.value === "con" ? "block" : "none";
}

campos.forEach(id =>
  document.getElementById(id).addEventListener("input", guardar)
);

novedades-frio.onchange = () => { toggleDetalles(); guardar(); };
novedades-precintos.onchange = () => { toggleDetalles(); guardar(); };

window.onload = cargar;

/* =======================
   GENERAR INFORME
======================= */
generar.onclick = () => {
  const fecha = fecha.value.split("-").reverse().join("/");
  const informe =
`INFORME SEGURIDAD ${fecha}
Informe Seguridad ${sector.value}

AUSENTISMO:
${ausentismo.value || "Sin novedades"}

SEGURIDAD / CCTV:
${cctv.value || "Sin novedades"}

VTS FRÍO:
${novedades-frio.value === "con" ? detalle-frio.value : "Sin novedades"}

VTS PRECINTOS:
${novedades-precintos.value === "con" ? detalle-precintos.value : "Sin novedades"}

PULMÓN Y PASILLOS TÉCNICOS:
${pulmon-pasillos.value || "Sin observaciones"}

RECEPCIÓN:
Móviles CD: ${moviles-cd.value || 0}`;

  cuadro-informe.value = informe;
  informe-generado.style.display = "block";
};

/* =======================
   COPIAR / VACIAR
======================= */
copiar.onclick = () => {
  cuadro-informe.select();
  navigator.clipboard.writeText(cuadro-informe.value);
  mensaje-copiado.style.display = "block";
  setTimeout(() => mensaje-copiado.style.display = "none", 2000);
};

vaciar.onclick = () => {
  localStorage.removeItem("informeSeguridad");
  campos.forEach(id => document.getElementById(id).value = "");
  informe-generado.style.display = "none";
  mensaje-vaciado.style.display = "block";
  setTimeout(() => mensaje-vaciado.style.display = "none", 2000);
};
</script>

</body>
</html>
